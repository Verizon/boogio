

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>boogio.aws_informer &mdash; boogio 1.0.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="boogio 1.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> boogio
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../boogio.aws_informer.html"> aws_informer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boogio.aws_surveyor.html"> aws_surveyor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boogio.aws_reporter.html"> aws_reporter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../boogio.sqs_sifter.html"> sqs_sifter</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">boogio</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>boogio.aws_informer</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for boogio.aws_informer</h1><div class="highlight"><pre>
<span></span><span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="c1"># (c) Verizon Inc. 2015</span>
<span class="c1"># Author: Scott Brown</span>
<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>

<span class="sd">&#39;&#39;&#39;Manage connecting to and retrieving information for specified AWS entities.</span>

<span class="sd">An instance of ``AWSInformer`` corresponds to some type of AWS entity,</span>
<span class="sd">and includes functionality to help manage the data associated with</span>
<span class="sd">that entity and its related AWS elements. Some examples include:</span>

<span class="sd">    *   An EC2 instance includes references to entities such as VPCs,</span>
<span class="sd">        subnets, security groups and so on. Using the</span>
<span class="sd">        ``EC2InstanceInformer`` subclass of ``AWSInformer``, you can</span>
<span class="sd">        easily associate records for these entities and see their</span>
<span class="sd">        relationships with the record for the EC2 instance.</span>

<span class="sd">    *   AWS entities have Tags that are represented internally as a</span>
<span class="sd">        mapping ``{&quot;Key&quot;: key, &quot;Value&quot;: value}``. Using</span>
<span class="sd">        an informer you can treat these as a mapping</span>
<span class="sd">        ``{&quot;key&quot;: &quot;value&quot;}`` for easier manipulation.</span>

<span class="sd">    *   Elastic Load Balancer entities have a DNS entry field, whose</span>
<span class="sd">        corresponding IP address an ``ELBInformer`` instance can look</span>
<span class="sd">        up and treat as a full fledged attribute of the informer.</span>

<span class="sd">``AWSInformer`` instances retrieve their data through an instance of</span>
<span class="sd">the` ``AWSMediator`` class. The ``AWSMediator`` instance caches entity</span>
<span class="sd">information so that, for example, multiple EC2 instances with the same</span>
<span class="sd">AWS Security Group assigned don&#39;t trigger multiple AWS queries for the</span>
<span class="sd">Security Group&#39;s data.</span>

<span class="sd">You can define filters in an ``AWSMediator`` instance that will be</span>
<span class="sd">applied to limit the entities retrieved from AWS by that mediator.</span>
<span class="sd">Mediator filters are defined per entity type using the</span>
<span class="sd">``add_filters()`` method. The allowed filters are generally those for</span>
<span class="sd">the relevant client&#39;s ``describe_X()`` method, where ``X`` depends on</span>
<span class="sd">the entity type. Thus the legal filters for an &quot;eip&quot; entity type are</span>
<span class="sd">those documented in the ec2 client&#39;s ``describe_addresses()`` method,</span>
<span class="sd">etc.</span>

<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="c1"># import itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="kn">import</span> <span class="nn">logging</span>
<span class="c1"># Set default logging handler to avoid &quot;No handler found&quot; warnings.</span>
<span class="k">try</span><span class="p">:</span>  <span class="c1"># Python 2.7+</span>
    <span class="kn">from</span> <span class="nn">logging</span> <span class="k">import</span> <span class="n">NullHandler</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">NullHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Placeholder handler.&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Dummy docstring.&#39;&#39;&#39;</span>
            <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">botocore</span>

<span class="kn">from</span> <span class="nn">boogio</span> <span class="k">import</span> <span class="n">site_boogio</span>
<span class="kn">from</span> <span class="nn">utensils</span> <span class="k">import</span> <span class="n">flatten</span>
<span class="c1"># from utensils import prune</span>

<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">NullHandler</span><span class="p">())</span>

<span class="n">DEFAULT_UTC_TIMESTAMP_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S+00:00&quot;</span>


<span class="c1"># TODO: These globals should probably be in the boogio __init__.py?</span>
<span class="n">_AWS_DOTDIR_NAME</span> <span class="o">=</span> <span class="s1">&#39;.aws&#39;</span>
<span class="n">_AWS_DOTDIR_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="n">_AWS_DOTDIR_NAME</span><span class="p">)</span>

<span class="n">_DEFAULT_BOOGIO_CONFIG_FILENAME</span> <span class="o">=</span> <span class="s1">&#39;boogio.json&#39;</span>
<span class="n">BOOGIO_CONFIG_FILENAME</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
    <span class="s1">&#39;BOOGIO_CONFIG_FILENAME&#39;</span><span class="p">,</span> <span class="n">_DEFAULT_BOOGIO_CONFIG_FILENAME</span>
    <span class="p">)</span>

<span class="n">_DEFAULT_BOOGIO_CONFIG_FILEPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">_AWS_DOTDIR_PATH</span><span class="p">,</span> <span class="n">BOOGIO_CONFIG_FILENAME</span>
    <span class="p">)</span>
<span class="n">BOOGIO_CONFIG_FILEPATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
    <span class="s1">&#39;BOOGIO_CONFIG_FILEPATH&#39;</span><span class="p">,</span> <span class="n">_DEFAULT_BOOGIO_CONFIG_FILEPATH</span>
    <span class="p">)</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">_load_boogio_config</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Load the boogio json config file, if present.&#39;&#39;&#39;</span>
    <span class="n">config_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">BOOGIO_CONFIG_FILEPATH</span><span class="p">):</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BOOGIO_CONFIG_FILEPATH</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fptr</span><span class="p">:</span>
            <span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fptr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">config_data</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="n">_BOOGIO_CONFIG</span> <span class="o">=</span> <span class="n">_load_boogio_config</span><span class="p">()</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">_entity_type_informer_class_map</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return a mapping of entity types to AWSInformer classes.&#39;&#39;&#39;</span>
    <span class="c1"># Update for new AWSInformer subclass.</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;ec2&#39;</span><span class="p">:</span> <span class="n">EC2InstanceInformer</span><span class="p">,</span>
        <span class="s1">&#39;elb&#39;</span><span class="p">:</span> <span class="n">ELBInformer</span><span class="p">,</span>
        <span class="s1">&#39;security_group&#39;</span><span class="p">:</span> <span class="n">SecurityGroupInformer</span><span class="p">,</span>
        <span class="s1">&#39;vpc&#39;</span><span class="p">:</span> <span class="n">VPCInformer</span><span class="p">,</span>
        <span class="s1">&#39;vpc_peering_connection&#39;</span><span class="p">:</span> <span class="n">VpcPeeringConnectionInformer</span><span class="p">,</span>
        <span class="s1">&#39;internet_gateway&#39;</span><span class="p">:</span> <span class="n">InternetGatewayInformer</span><span class="p">,</span>
        <span class="s1">&#39;nat_gateway&#39;</span><span class="p">:</span> <span class="n">NatGatewayInformer</span><span class="p">,</span>
        <span class="s1">&#39;autoscaling&#39;</span><span class="p">:</span> <span class="n">AutoScalingGroupInformer</span><span class="p">,</span>
        <span class="s1">&#39;subnet&#39;</span><span class="p">:</span> <span class="n">SubnetInformer</span><span class="p">,</span>
        <span class="s1">&#39;network_interface&#39;</span><span class="p">:</span> <span class="n">NetworkInterfaceInformer</span><span class="p">,</span>
        <span class="s1">&#39;network_acl&#39;</span><span class="p">:</span> <span class="n">NetworkAclInformer</span><span class="p">,</span>
        <span class="s1">&#39;route_table&#39;</span><span class="p">:</span> <span class="n">RouteTableInformer</span><span class="p">,</span>
        <span class="s1">&#39;eip&#39;</span><span class="p">:</span> <span class="n">EIPInformer</span><span class="p">,</span>
        <span class="s1">&#39;emr&#39;</span><span class="p">:</span> <span class="n">EMRInformer</span><span class="p">,</span>
        <span class="s1">&#39;sqs&#39;</span><span class="p">:</span> <span class="n">SQSInformer</span><span class="p">,</span>
        <span class="s1">&#39;iam&#39;</span><span class="p">:</span> <span class="n">IAMInformer</span><span class="p">,</span>
        <span class="c1"># &#39;ip_permissions&#39;: IpPermissionsInformer,</span>
        <span class="p">}</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">_informer_identifier_key_map</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return a mapping of AWSInformer classes and their identifier keys.&#39;&#39;&#39;</span>
    <span class="c1"># Update for new AWSInformer subclass.</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="n">ELBInformer</span><span class="p">:</span> <span class="s1">&#39;LoadBalancerName&#39;</span><span class="p">,</span>
        <span class="n">EMRInformer</span><span class="p">:</span> <span class="s1">&#39;Id&#39;</span><span class="p">,</span>
        <span class="n">EC2InstanceInformer</span><span class="p">:</span> <span class="s1">&#39;InstanceId&#39;</span><span class="p">,</span>
        <span class="n">SecurityGroupInformer</span><span class="p">:</span> <span class="s1">&#39;GroupId&#39;</span><span class="p">,</span>
        <span class="n">VPCInformer</span><span class="p">:</span> <span class="s1">&#39;VpcId&#39;</span><span class="p">,</span>
        <span class="n">VpcPeeringConnectionInformer</span><span class="p">:</span> <span class="s1">&#39;VpcPeeringConnectionId&#39;</span><span class="p">,</span>
        <span class="n">InternetGatewayInformer</span><span class="p">:</span> <span class="s1">&#39;InternetGatewayId&#39;</span><span class="p">,</span>
        <span class="n">NatGatewayInformer</span><span class="p">:</span> <span class="s1">&#39;NatGatewayId&#39;</span><span class="p">,</span>
        <span class="n">AutoScalingGroupInformer</span><span class="p">:</span> <span class="s1">&#39;AutoScalingGroupARN&#39;</span><span class="p">,</span>
        <span class="n">SubnetInformer</span><span class="p">:</span> <span class="s1">&#39;SubnetId&#39;</span><span class="p">,</span>
        <span class="n">NetworkInterfaceInformer</span><span class="p">:</span> <span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">,</span>
        <span class="n">NetworkAclInformer</span><span class="p">:</span> <span class="s1">&#39;NetworkAclId&#39;</span><span class="p">,</span>
        <span class="n">RouteTableInformer</span><span class="p">:</span> <span class="s1">&#39;RouteTableId&#39;</span><span class="p">,</span>
        <span class="n">EIPInformer</span><span class="p">:</span> <span class="s1">&#39;PublicIp&#39;</span><span class="p">,</span>
        <span class="n">SQSInformer</span><span class="p">:</span> <span class="s1">&#39;QueueURL&#39;</span><span class="p">,</span>
        <span class="p">}</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<span class="k">def</span> <span class="nf">_prevent_duplicate_informer_init_if_cached</span><span class="p">(</span><span class="n">original_init</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Only proceed with __init__() if an informer isn&#39;t already cached.</span>

<span class="sd">    AWSInformer subclass __init__ methods can be called multiple</span>
<span class="sd">    times on a single instance, due to the redefinition of</span>
<span class="sd">    __new__() to check for an existing informer in the mediator&#39;s</span>
<span class="sd">    informer_cache. If we find the resource&#39;s identifier in the</span>
<span class="sd">    mediator&#39;s informer_cache, we don&#39;t do any initialization</span>
<span class="sd">    here. If we don&#39;t find it, we both initialize and update the</span>
<span class="sd">    mediator&#39;s cache.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># pylint: disable=missing-docstring</span>

        <span class="n">mediator</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mediator&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;mediator&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># We have to figure out if we&#39;re already in the mediator&#39;s</span>
        <span class="c1"># informer cache. Our key would be our resource identifier.</span>
        <span class="c1"># pylint: disable=protected-access</span>
        <span class="n">entity_identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_init_entity_identifier</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>

        <span class="c1"># If our attempt to look it up failed, entity_identifier could</span>
        <span class="c1"># be None, which shouldn&#39;t be a key in the mediator&#39;s</span>
        <span class="c1"># informer_cache anyway.</span>
        <span class="k">if</span> <span class="n">mediator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span>

        <span class="k">if</span> <span class="p">(</span>
                <span class="n">mediator</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
                <span class="n">entity_identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="c1"># We didn&#39;t find ourself in the cache, so we&#39;ll initialize</span>
            <span class="c1"># ourself anew.</span>
            <span class="n">original_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c1"># Put ourself in the cache for next time.</span>
            <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span><span class="p">[</span><span class="n">entity_identifier</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We found ourself in the cache. Let&#39;s make sure it&#39;s</span>
            <span class="c1"># really us.</span>
            <span class="k">assert</span> <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span><span class="p">[</span><span class="n">entity_identifier</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">self</span>

    <span class="k">return</span> <span class="n">decorated</span>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="entity_types"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.entity_types">[docs]</a><span class="k">def</span> <span class="nf">entity_types</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return a list of entity types that have AWSInformer classes.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_entity_type_informer_class_map</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="informer_class"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.informer_class">[docs]</a><span class="k">def</span> <span class="nf">informer_class</span><span class="p">(</span><span class="n">etype</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Map entity type to the AWSInformer class name.&#39;&#39;&#39;</span>

    <span class="c1"># All entity_types() values must be supported here.</span>
    <span class="k">return</span> <span class="n">_entity_type_informer_class_map</span><span class="p">()[</span><span class="n">etype</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="informer_entity_type"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.informer_entity_type">[docs]</a><span class="k">def</span> <span class="nf">informer_entity_type</span><span class="p">(</span><span class="n">iclass</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Map AWSInformer class to entity type.&#39;&#39;&#39;</span>

    <span class="n">type_class_map</span> <span class="o">=</span> <span class="n">_entity_type_informer_class_map</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">iclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">type_class_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">possible_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">type_class_map</span>
        <span class="k">if</span> <span class="n">type_class_map</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">iclass</span>
        <span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">possible_types</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="regional_types"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.regional_types">[docs]</a><span class="k">def</span> <span class="nf">regional_types</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return the Informer entity types with instances in each region.&#39;&#39;&#39;</span>
    <span class="c1"># Update for new AWSInformer subclass.</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="s1">&#39;ec2&#39;</span><span class="p">,</span> <span class="s1">&#39;elb&#39;</span><span class="p">,</span> <span class="s1">&#39;security_group&#39;</span><span class="p">,</span>
        <span class="s1">&#39;vpc&#39;</span><span class="p">,</span> <span class="s1">&#39;vpc_peering_connection&#39;</span><span class="p">,</span> <span class="s1">&#39;internet_gateway&#39;</span><span class="p">,</span> <span class="s1">&#39;nat_gateway&#39;</span><span class="p">,</span>
        <span class="s1">&#39;autoscaling&#39;</span><span class="p">,</span>
        <span class="s1">&#39;subnet&#39;</span><span class="p">,</span> <span class="s1">&#39;network_interface&#39;</span><span class="p">,</span> <span class="s1">&#39;network_acl&#39;</span><span class="p">,</span> <span class="s1">&#39;route_table&#39;</span><span class="p">,</span>
        <span class="s1">&#39;eip&#39;</span><span class="p">,</span> <span class="s1">&#39;emr&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;ip_permissions&#39;</span>
        <span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="regionless_types"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.regionless_types">[docs]</a><span class="k">def</span> <span class="nf">regionless_types</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return the Informer entity types with instances not tied to a region.&#39;&#39;&#39;</span>
    <span class="c1"># Update for new AWSInformer subclass.</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;sqs&#39;</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="unitary_types"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.unitary_types">[docs]</a><span class="k">def</span> <span class="nf">unitary_types</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Return the Informer entity types with a unique instance.&#39;&#39;&#39;</span>
    <span class="c1"># Update for new AWSInformer subclass.</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;iam&#39;</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="rekey"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.rekey">[docs]</a><span class="k">def</span> <span class="nf">rekey</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">new_key_map</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Change the keys in a dictionary.</span>

<span class="sd">    Arguments:</span>

<span class="sd">        current (dict):</span>
<span class="sd">            A dictionary whose keys are to be changed.</span>

<span class="sd">    new_key_map (dict):</span>
<span class="sd">        A dictionary whose keys are the *old* keys and whose values</span>
<span class="sd">        are the *new* keys.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; d = {&#39;this&#39;: 42, &#39;that&#39;: 99, &#39;another&#39;: 64}</span>
<span class="sd">        &gt;&gt;&gt; new_keys = {&#39;this&#39;: &#39;these&#39;, &#39;that&#39;: &#39;those&#39;}</span>
<span class="sd">        &gt;&gt;&gt; rekey(d, new_keys)</span>
<span class="sd">        &gt;&gt;&gt; d</span>
<span class="sd">        {&#39;these&#39;: 42, &#39;those&#39;: 99, &#39;another&#39;: 64}</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Check that we won&#39;t clobber any existing keys. We need to make</span>
    <span class="c1"># sure that no key will be changed to an existing key, which means</span>
    <span class="c1"># both the old key and new key from new_key_map occur in current.</span>
    <span class="n">collisions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_key_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">current</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">current</span>
        <span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">collisions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s1">&#39;collision between existing and new keys for key changes&#39;</span>
            <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">collisions</span><span class="p">])</span>
            <span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">current</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_key_map</span><span class="p">:</span>
            <span class="n">current</span><span class="p">[</span><span class="n">new_key_map</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span> <span class="o">=</span> <span class="n">current</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">current</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="get_paged_data"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.get_paged_data">[docs]</a><span class="k">def</span> <span class="nf">get_paged_data</span><span class="p">(</span>
        <span class="n">func</span><span class="p">,</span>
        <span class="n">data_keys</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Pull paged data from AWS until all pages are retrieved.</span>

<span class="sd">    Arguments:</span>

<span class="sd">        func (function):</span>
<span class="sd">            The function that will be called to retrieve data pages.</span>

<span class="sd">        data_keys (str or list of str):</span>
<span class="sd">            A list of strings specifying the item keys to be extracted</span>
<span class="sd">            from each page of data.</span>

<span class="sd">        *args:</span>
<span class="sd">            Arbitrary positional arguments.</span>

<span class="sd">        **kwargs:</span>
<span class="sd">            Arbitrary keyword arguments.</span>

<span class="sd">    This method is used in subprocesses by ``get_one_request`` to</span>
<span class="sd">    retrieve potentially paged data from an AWS access function. The</span>
<span class="sd">    ``*args`` and ``**kwargs`` arguments are passed to the ``func``</span>
<span class="sd">    argument when it&#39;s called.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Error reporting reference string.</span>
    <span class="n">err_ref_string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
        <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="n">data_keys</span><span class="p">,</span>
        <span class="n">args</span><span class="p">,</span>
        <span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="c1"># Allow passing a single key without wrapping in a list.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_keys</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">data_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_keys</span><span class="p">]</span>

    <span class="c1"># Do this once outside so we get our first Marker if we&#39;re paged.</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">data_page</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s1">&#39;Exception </span><span class="si">%s</span><span class="s1"> getting data page 1 for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="n">err_ref_string</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">data_key</span> <span class="ow">in</span> <span class="n">data_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data_key</span> <span class="ow">in</span> <span class="n">data_page</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_page</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span>

    <span class="k">while</span> <span class="s1">&#39;IsTruncated&#39;</span> <span class="ow">in</span> <span class="n">data_page</span> <span class="ow">and</span> <span class="n">data_page</span><span class="p">[</span><span class="s1">&#39;IsTruncated&#39;</span><span class="p">]:</span>

        <span class="n">marker</span> <span class="o">=</span> <span class="n">data_page</span><span class="p">[</span><span class="s1">&#39;Marker&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_page</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span>
                <span class="n">Marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                <span class="n">MaxItems</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s1">&#39;Exception </span><span class="si">%s</span><span class="s1"> getting data for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="n">err_ref_string</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">data_key</span> <span class="ow">in</span> <span class="n">data_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_key</span> <span class="ow">in</span> <span class="n">data_page</span><span class="p">:</span>
                <span class="n">response</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">data_page</span><span class="p">[</span><span class="n">data_key</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">response</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="get_one_request"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.get_one_request">[docs]</a><span class="k">def</span> <span class="nf">get_one_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Handle one parallelized request.</span>

<span class="sd">    This gets called in a subprocess, and has to reconstruct the</span>
<span class="sd">    session and client. All of the execution is wrapped in a broad</span>
<span class="sd">    &quot;try...except Exception&quot; block because exceptions in subprocesses</span>
<span class="sd">    breaks multiprocessing and leaves things hung.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">err</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Wrap the whole thing in a try/except because any uncaught</span>
    <span class="c1"># exception hangs the multiprocessing and leaves zombies when the</span>
    <span class="c1"># parent is killed.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
            <span class="o">**</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;session_kwargs&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;client_type&#39;</span><span class="p">])</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;client_method&#39;</span><span class="p">])</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;method_args&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;method_kwargs&#39;</span><span class="p">]</span>
        <span class="n">data_keys</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;response_data_keys&#39;</span><span class="p">]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">get_paged_data</span><span class="p">(</span>
            <span class="n">method</span><span class="p">,</span>
            <span class="n">data_keys</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">exc</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span><span class="p">]</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSSessionError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSSessionError">[docs]</a><span class="k">class</span> <span class="nc">AWSSessionError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An error associated with an AWS Session has occurred.&#39;&#39;&#39;</span>

    <span class="c1"># pylint: disable=unused-argument</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSSessionError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSSessionError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">msg</span>

<div class="viewcode-block" id="AWSSessionError.__str__"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSSessionError.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a string representation.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediatorError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediatorError">[docs]</a><span class="k">class</span> <span class="nc">AWSMediatorError</span><span class="p">(</span><span class="n">AWSSessionError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An error associated with an AWS Mediator has occurred.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSMediatorError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSMediatorError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformerError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformerError">[docs]</a><span class="k">class</span> <span class="nc">AWSInformerError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An error associated with an AWS Informer has occurred.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pylint: disable=unused-argument</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSInformerError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSInformerError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformerResourceError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformerResourceError">[docs]</a><span class="k">class</span> <span class="nc">AWSInformerResourceError</span><span class="p">(</span><span class="n">AWSSessionError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An associated with an AWS Informer resource has occurred.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSInformerResourceError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span>
            <span class="n">AWSInformerResourceError</span><span class="p">,</span> <span class="bp">self</span>
            <span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformerResourceTypeError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformerResourceTypeError">[docs]</a><span class="k">class</span> <span class="nc">AWSInformerResourceTypeError</span><span class="p">(</span><span class="n">AWSSessionError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An error associated with the type of an AWS Informer has occurred.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSInformerResourceTypeError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span>
            <span class="n">AWSInformerResourceTypeError</span><span class="p">,</span> <span class="bp">self</span>
            <span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformerRegionError"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformerRegionError">[docs]</a><span class="k">class</span> <span class="nc">AWSInformerRegionError</span><span class="p">(</span><span class="n">AWSInformerError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;An AWSInformer error associated with an AWS region has occurred.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSInformerRegionError instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSInformerRegionError</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSSession"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSSession">[docs]</a><span class="k">class</span> <span class="nc">AWSSession</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage AWS sessions.</span>

<span class="sd">    Arguments:</span>

<span class="sd">        region_name (string, optional):</span>
<span class="sd">            The name of the AWS region to use for session</span>
<span class="sd">            creation. This is passed through to initialize a</span>
<span class="sd">            ``boto3.session.Session`` instance.</span>

<span class="sd">        profile_name (string, optional):</span>
<span class="sd">            The name of the profile record in</span>
<span class="sd">            :file:`$HOME/.aws/credentials` to use for session</span>
<span class="sd">            creation. This is passed through to initialize a</span>
<span class="sd">            ``boto3.session.Session`` instance.</span>

<span class="sd">        session (boto3.session.Session, optional):</span>
<span class="sd">            An existing ``boto3.session.Session`` instance to</span>
<span class="sd">            use for connections.</span>

<span class="sd">    Raises:</span>

<span class="sd">        ValueError: If an existing session and either a</span>
<span class="sd">        profile_name or region_name are provided.</span>

<span class="sd">    An ``AWSSession`` is a simple wrapper for the underlying boto3</span>
<span class="sd">    session.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create an AWSSession session manager instance.&#39;&#39;&#39;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">region_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">profile_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;region or profile is redundant when session is provided&quot;</span>
                    <span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSSession</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s1">&#39;assigning existing session to new AWSSession instance&#39;</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">profile_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">region_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span> <span class="o">=</span> <span class="n">profile_name</span>
            <span class="c1"># if self._profile_name is None:</span>
            <span class="c1">#     self._profile_name = &#39;default&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span> <span class="o">=</span> <span class="n">region_name</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">refresh_session</span><span class="p">()</span>
            <span class="c1"># self.session = boto3.session.Session(</span>
            <span class="c1">#     region_name=region_name,</span>
            <span class="c1">#     profile_name=profile_name</span>
            <span class="c1">#     )</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;initialized AWSSession: profile_name &quot;</span><span class="si">%s</span><span class="s1">&quot;, region_name &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_session_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;A dict with the session.Session() parameters for this session.</span>

<span class="sd">        If session parameters aren&#39;t explicitly provided, boto will</span>
<span class="sd">        fall back to the search order described here:</span>

<span class="sd">        http://boto3.readthedocs.io/en/latest/guide/configuration.html</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">session_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">:</span>
            <span class="n">session_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;profile_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">:</span>
            <span class="n">session_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;region_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">session_kwargs</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSSession.refresh_session"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSSession.refresh_session">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Recreate ``self.session`` with the current parameters.&#39;&#39;&#39;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_session_kwargs</span><span class="p">())</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s1">&#39;refreshed AWSSession: profile_name &quot;</span><span class="si">%s</span><span class="s1">&quot;, region_name &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span>
            <span class="p">)</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="c1"># We&#39;ll need these as properties in the subclass.</span>
    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_get_profile_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Property getter.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span>

    <span class="k">def</span> <span class="nf">_set_profile_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Property setter.&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refresh_session</span><span class="p">()</span>

    <span class="n">profile_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_profile_name</span><span class="p">,</span> <span class="n">_set_profile_name</span><span class="p">)</span></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator">[docs]</a><span class="k">class</span> <span class="nc">AWSMediator</span><span class="p">(</span><span class="n">AWSSession</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage wholesale AWS entity retrieval in a lazy fashion.</span>

<span class="sd">    See ``AWSSession`` for argument descriptions.</span>

<span class="sd">    The ``AWSMediator`` class extends ``AWSSession`` to provide AWS</span>
<span class="sd">    entity data retrieval and caching.</span>

<span class="sd">    *   Through its ``entities()`` method, an ``AWSMediator`` instance</span>
<span class="sd">        makes transparent the distinction between AWS entities that</span>
<span class="sd">        are full fledged AWS services (e.g., *ec2*, *s3*) and entities</span>
<span class="sd">        that are retrieved through other services (e.g., *security</span>
<span class="sd">        group*, *network interface*).</span>

<span class="sd">    *   An ``AWSMediator`` instance caches records it has retrieved so</span>
<span class="sd">        that subsequent requests for the same entity don&#39;t required an</span>
<span class="sd">        additional AWS query. It also caches AWSInformers so that the</span>
<span class="sd">        same informers are used when the same mediator is present.</span>

<span class="sd">    *   In some cases, an ``AWSMediator`` parallelizes AWS queries for</span>
<span class="sd">        faster retrieval.</span>

<span class="sd">    Entity retrieval filters can be added to the mediator on a per-</span>
<span class="sd">    entity-type basis. These filters will then limit the entities</span>
<span class="sd">    retrieved from AWS for that entity type. See the ``add_filters()``</span>
<span class="sd">    method for details.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># TODO: Set a cache timeout and autoflush.</span>

    <span class="n">PARALLEL_FETCH_PROCESS_COUNT</span> <span class="o">=</span> <span class="mi">48</span>

    <span class="c1"># We cache at the AWSMediator class level all informers managed by</span>
    <span class="c1"># this mediator, indexed by their unique identifiers, so that we</span>
    <span class="c1"># can avoid duplicate records for the same AWS entity and re-use</span>
    <span class="c1"># existing records when, e.g., expanding other entities.</span>
    <span class="n">informer_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_account_descriptors</span><span class="p">(</span><span class="n">account_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the account name and description customizations.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            account_id (str):</span>
<span class="sd">                The AWS account ID for the account.</span>

<span class="sd">        Returns:</span>

<span class="sd">            A dictionary with the name and description of the account</span>
<span class="sd">            if found in boogio.json or site-boogio::</span>

<span class="sd">                {</span>
<span class="sd">                    &#39;name&#39;: &lt;account-name&gt;,</span>
<span class="sd">                    &#39;description&#39;: &lt;account-description&gt;</span>
<span class="sd">                    }</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">account_id</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Look for account name, starting with the user&#39;s boogio</span>
        <span class="c1"># config file.</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s1">&#39;common&#39;</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span> <span class="ow">and</span>
                <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="k">if</span> <span class="n">account_id</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="n">account_id</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># We didn&#39;t find it in the user&#39;s boogio config file, so we&#39;ll</span>
        <span class="c1"># look in site-boogio.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site_boogio</span><span class="p">,</span> <span class="s1">&#39;account_name_by_id&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">account_id</span> <span class="ow">in</span> <span class="n">site_boogio</span><span class="o">.</span><span class="n">account_name_by_id</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">site_boogio</span><span class="o">.</span><span class="n">account_name_by_id</span><span class="p">[</span><span class="n">account_id</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Look for account description, starting with the user&#39;s</span>
        <span class="c1"># boogio config file.</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s1">&#39;common&#39;</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span> <span class="ow">and</span>
                <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="k">if</span> <span class="n">account_id</span> <span class="ow">in</span> <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]:</span>
                <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">_BOOGIO_CONFIG</span><span class="p">[</span><span class="s1">&#39;common&#39;</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">][</span><span class="n">account_id</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># We didn&#39;t find it in the user&#39;s boogio config file, so we&#39;ll</span>
        <span class="c1"># look in site-boogio.</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">site_boogio</span><span class="p">,</span> <span class="s1">&#39;account_description_by_id&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">account_id</span> <span class="ow">in</span> <span class="n">site_boogio</span><span class="o">.</span><span class="n">account_description_by_id</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">site_boogio</span><span class="o">.</span><span class="n">account_description_by_id</span><span class="p">[</span><span class="n">account_id</span><span class="p">]</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">description</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSMediator instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSMediator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># TODO: Move this into _get_account_descriptors, and check for</span>
        <span class="c1"># the profile name in config files maybe?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;sts&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()[</span><span class="s2">&quot;Account&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">descriptors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_account_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">account_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_name</span> <span class="o">=</span> <span class="n">descriptors</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">account_desc</span> <span class="o">=</span> <span class="n">descriptors</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># self._resources = {</span>
        <span class="c1">#     resource: None</span>
        <span class="c1">#     for resource in self.session.get_available_resources()</span>
        <span class="c1">#     }</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_services</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">service</span><span class="p">:</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">service</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_available_services</span><span class="p">()</span>
            <span class="p">}</span>

        <span class="c1"># Update for new AWSInformer subclass.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;security_group&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;vpc&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;vpc_peering_connection&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;internet_gateway&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;nat_gateway&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;subnet&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;network_interface&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;network_acl&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;route_table&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;eip&#39;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">profile_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the profile property.&#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span>

    <span class="nd">@profile_name</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">profile_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the profile property.</span>

<span class="sd">        If the profile_name is changed, all cached records will be</span>
<span class="sd">        flushed.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># We need to flush() if the profile_name gets changed.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AWSMediator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_set_profile_name</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.add_filters"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.add_filters">[docs]</a>    <span class="k">def</span> <span class="nf">add_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">new_filters</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add AWS entity retrieval filters to the mediator.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            entity_type (string):</span>

<span class="sd">                An informer entity type to which this filter will</span>
<span class="sd">                apply.</span>

<span class="sd">            new_filters (dict):</span>

<span class="sd">                The *Name* strings and *Values* lists for the filters.</span>

<span class="sd">        Example::</span>

<span class="sd">            &gt;&gt;&gt; mediator = aws_informer.AWSMediator()</span>
<span class="sd">            &gt;&gt;&gt; mediator.add_filters(</span>
<span class="sd">            ...     &#39;ec2&#39;, {&#39;instance-state-name&#39;: [&#39;running&#39;]}</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; mediator.filters</span>
<span class="sd">            {&#39;ec2&#39;: {&#39;instance-state-name&#39;: [&#39;running&#39;]}}}</span>

<span class="sd">            &gt;&gt;&gt; mediator.add_filters(</span>
<span class="sd">            ...     &#39;eip&#39;, {</span>
<span class="sd">            ...         &#39;public-ip&#39;: [&#39;123.45.67.89&#39;, &#39;56.78.91.234&#39;],</span>
<span class="sd">            ...         &#39;domain&#39;: [&#39;vpc&#39;]</span>
<span class="sd">            ...         }</span>
<span class="sd">            ...     )</span>
<span class="sd">            &gt;&gt;&gt; mediator.filters</span>
<span class="sd">            {&#39;ec2&#39;: {&#39;instance-state-name&#39;: [&#39;running&#39;]}},</span>
<span class="sd">            &#39;eip&#39;, {&#39;public-ip&#39;: [&#39;123.45.67.89&#39;, &#39;56.78.91.234&#39;],</span>
<span class="sd">            &#39;domain&#39;: [&#39;vpc&#39;]}}</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">filter_name</span><span class="p">,</span> <span class="n">filter_values</span><span class="p">)</span> <span class="ow">in</span> <span class="n">new_filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

            <span class="k">if</span> <span class="n">filter_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">][</span><span class="n">filter_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">][</span><span class="n">filter_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">set</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">][</span><span class="n">filter_name</span><span class="p">]</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">filter_values</span><span class="p">))</span>
                <span class="p">)</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.remove_all_filters"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.remove_all_filters">[docs]</a>    <span class="k">def</span> <span class="nf">remove_all_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">remove_types</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Remove AWS entity retrieval filters from the mediator.&#39;&#39;&#39;</span>
        <span class="n">existing_types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">existing_type</span> <span class="ow">in</span> <span class="n">existing_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">remove_types</span> <span class="o">==</span> <span class="p">()</span> <span class="ow">or</span> <span class="n">existing_type</span> <span class="ow">in</span> <span class="n">remove_types</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">existing_type</span><span class="p">]</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_filters_kwarg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">use_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a structure representing the &#39;Filters&#39; parameter.</span>

<span class="sd">        The parameter is used when fetching entities for this</span>
<span class="sd">        entity_type.</span>

<span class="sd">        The structure represent this mediator&#39;s filters(entity_type)</span>

<span class="sd">            {&#39;name1&#39;: [&#39;v1&#39;, ...], &#39;name2&#39;: [...], &#39;name3&#39;: [...]}</span>
<span class="sd">        as</span>

<span class="sd">            {&#39;Filters&#39;:</span>
<span class="sd">                [</span>
<span class="sd">                    {&#39;Name&#39;: &#39;name1&#39;, &#39;Values&#39;: [&#39;v1&#39;, ...]},</span>
<span class="sd">                    {&#39;Name&#39;: &#39;name2&#39;, &#39;Values&#39;: [...]},</span>
<span class="sd">                    {&#39;Name&#39;: &#39;name3&#39;, &#39;Values&#39;: [...]},</span>
<span class="sd">                    ]</span>
<span class="sd">                }</span>

<span class="sd">        See, e.g., http://boto3.readthedocs.org/en/latest/reference/</span>
<span class="sd">        services/ec2.html#EC2.Client.describe_addresses for an</span>
<span class="sd">        example of filtering a client entity retrieval.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">filters_kwarg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Filters&#39;</span><span class="p">:</span> <span class="p">[]}</span>

        <span class="k">if</span> <span class="n">use_filters</span> <span class="ow">and</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">filters_kwarg</span><span class="p">[</span><span class="s1">&#39;Filters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;Values&#39;</span><span class="p">:</span> <span class="n">vals</span><span class="p">})</span>

        <span class="k">return</span> <span class="n">filters_kwarg</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.flush"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.flush">[docs]</a>    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">cached_entity_types</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove indicated entity types from the internal cache.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            cached_entity_types (tuple of string):</span>
<span class="sd">                The entity types to flush. If not specified, all</span>
<span class="sd">                cached entities will be flushed.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cached_entity_types</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cached_entity_types</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;clearing cache of entity types: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cached_entity_types</span><span class="p">)</span>

        <span class="c1"># Delete cached informers.</span>
        <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">identifier</span><span class="p">,</span> <span class="n">informer</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">informer_cache</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">informer</span><span class="o">.</span><span class="n">entity_type</span> <span class="ow">in</span> <span class="n">cached_entity_types</span><span class="p">:</span>
                <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">identifier</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">informer_cache</span><span class="p">[</span><span class="n">identifier</span><span class="p">]</span>

        <span class="c1"># Delete entity resource records.</span>
        <span class="k">for</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="n">cached_entity_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">entity_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span> <span class="ow">and</span>
                    <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>

                <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Unknown entity type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AWSMediatorError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># elif entity_type in self._resources:</span>
            <span class="c1">#     del self._resources[entity_type]</span>
            <span class="c1">#     self._resources[entity_type] = None</span>

            <span class="k">elif</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">use_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retrieve all instances of the indicated entity type from AWS.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            entity_type (string):</span>
<span class="sd">                The entity type to retrieve.</span>

<span class="sd">            use_filters (bool, default=True):</span>
<span class="sd">                If True, filter retrieval of the requested</span>
<span class="sd">                entity type using the mediator&#39;s filters attribute</span>
<span class="sd">                item for that entity type. If False, retrieve all</span>
<span class="sd">                entities of the requested entity type.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fetching </span><span class="si">%s</span><span class="s1"> entities...&#39;</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_filters</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;filtering with </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">)</span>

        <span class="c1"># TODO: Helpers for pagination.</span>
        <span class="k">def</span> <span class="nf">paginated</span><span class="p">(</span>
                <span class="n">method</span><span class="p">,</span> <span class="n">data_key</span><span class="p">,</span>
                <span class="n">page_key</span><span class="o">=</span><span class="s1">&#39;Marker&#39;</span><span class="p">,</span> <span class="n">next_page_key</span><span class="o">=</span><span class="s1">&#39;NextMarker&#39;</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="sd">&#39;&#39;&#39;Call ``method`` until all pages of data are returned.&#39;&#39;&#39;</span>
            <span class="n">final_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">more_pages</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">next_page_marker</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">while</span> <span class="n">more_pages</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">next_page_marker</span><span class="p">:</span>
                    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">page_key</span><span class="p">:</span> <span class="n">next_page_marker</span><span class="p">}</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">next_page_marker</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">next_page_key</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">next_page_marker</span><span class="p">:</span>
                    <span class="n">more_pages</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">final_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="n">data_key</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">final_data</span>

        <span class="c1"># Update for new AWSInformer subclass.</span>
        <span class="n">raw_entity_collection</span> <span class="o">=</span> <span class="p">{</span>

            <span class="c1"># &#39;ec2&#39;: self.session.resource(&#39;ec2&#39;).instances.all,</span>
            <span class="s1">&#39;ec2&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">ec2</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">data</span>
                <span class="k">for</span> <span class="n">ec2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">],</span>

            <span class="c1"># &#39;s3&#39;: self.session.resource(&#39;s3&#39;).buckets.all,</span>
            <span class="s1">&#39;s3&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">s3</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">data</span>
                <span class="k">for</span> <span class="n">s3</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">buckets</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">],</span>
            <span class="s1">&#39;iam&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[],</span>

            <span class="s1">&#39;sqs&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="s1">&#39;QueueURL&#39;</span><span class="p">:</span> <span class="n">q</span><span class="o">.</span><span class="n">url</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">queues</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">],</span>

            <span class="c1"># &#39;elb&#39;: lambda: self.session.client(</span>
            <span class="c1">#     &#39;elb&#39;</span>
            <span class="c1">#     ).describe_load_balancers()[&#39;LoadBalancerDescriptions&#39;],</span>

            <span class="s1">&#39;elb&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">paginated</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;elb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe_load_balancers</span><span class="p">,</span>
                <span class="s1">&#39;LoadBalancerDescriptions&#39;</span>
                <span class="p">),</span>

            <span class="s1">&#39;security_group&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_security_groups</span><span class="p">()[</span><span class="s1">&#39;SecurityGroups&#39;</span><span class="p">],</span>

            <span class="s1">&#39;vpc&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">()[</span><span class="s1">&#39;Vpcs&#39;</span><span class="p">],</span>

            <span class="s1">&#39;vpc_peering_connection&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_vpc_peering_connections</span><span class="p">()[</span><span class="s1">&#39;VpcPeeringConnections&#39;</span><span class="p">],</span>

            <span class="s1">&#39;internet_gateway&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_internet_gateways</span><span class="p">()[</span><span class="s1">&#39;InternetGateways&#39;</span><span class="p">],</span>

            <span class="s1">&#39;nat_gateway&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_nat_gateways</span><span class="p">()[</span><span class="s1">&#39;NatGateways&#39;</span><span class="p">],</span>

            <span class="s1">&#39;autoscaling&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;autoscaling&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_auto_scaling_groups</span><span class="p">()[</span><span class="s1">&#39;AutoScalingGroups&#39;</span><span class="p">],</span>

            <span class="s1">&#39;subnet&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">()[</span><span class="s1">&#39;Subnets&#39;</span><span class="p">],</span>

            <span class="s1">&#39;network_interface&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_network_interfaces</span><span class="p">()[</span><span class="s1">&#39;NetworkInterfaces&#39;</span><span class="p">],</span>

            <span class="s1">&#39;network_acl&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_network_acls</span><span class="p">()[</span><span class="s1">&#39;NetworkAcls&#39;</span><span class="p">],</span>

            <span class="s1">&#39;route_table&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_route_tables</span><span class="p">()[</span><span class="s1">&#39;RouteTables&#39;</span><span class="p">],</span>

            <span class="s1">&#39;eip&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;ec2&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">describe_addresses</span><span class="p">(</span>
                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters_kwarg</span><span class="p">(</span><span class="s1">&#39;eip&#39;</span><span class="p">,</span> <span class="n">use_filters</span><span class="p">)</span>
                    <span class="p">)[</span><span class="s1">&#39;Addresses&#39;</span><span class="p">],</span>

            <span class="s1">&#39;emr&#39;</span><span class="p">:</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
                <span class="s1">&#39;emr&#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">list_clusters</span><span class="p">()[</span><span class="s1">&#39;Clusters&#39;</span><span class="p">],</span>

            <span class="p">}[</span><span class="n">entity_type</span><span class="p">]()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;fetched </span><span class="si">%s</span><span class="s1"> entities&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_entity_collection</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">raw_entity_collection</span><span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.client"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.client">[docs]</a>    <span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a client from the _clients dict, creating one if needed.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            client_type (string):</span>
<span class="sd">                The type of AWS client to create; e.g., ``ec2`` or</span>
<span class="sd">                ``s3``.</span>

<span class="sd">        An ``AWSMediator`` instance maintains an internal list of AWS</span>
<span class="sd">        clients for different AWS services, created using this</span>
<span class="sd">        mediator&#39;s ``Session`` instance. This method returns the</span>
<span class="sd">        client for the indicated entity type, creating a new client</span>
<span class="sd">        if one isn&#39;t already present.</span>

<span class="sd">        Note that client types are a subset of the legal</span>
<span class="sd">        ``AWSInformer`` entity types.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">client_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">client_type</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">DataNotFoundError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AWSMediatorError</span><span class="p">(</span>
                    <span class="s2">&quot;can&#39;t create client for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client_type</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">client_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_client</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clients</span><span class="p">[</span><span class="n">client_type</span><span class="p">]</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.services"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.services">[docs]</a>    <span class="k">def</span> <span class="nf">services</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retrieve a list of services, if necessary, and return the list.&#39;&#39;&#39;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">service_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">:</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Unknown service type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">service_type</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AWSMediatorError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">service_type</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">service_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="n">service_type</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">service_type</span><span class="p">]</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSMediator.entities"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.entities">[docs]</a>    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">use_filters</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retrieve entities from AWS (if necessary) and return them as a list.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            entity_type (string):</span>
<span class="sd">                The entity type requested.</span>

<span class="sd">            use_filters (bool, default=True):</span>
<span class="sd">                If ``_fetch()`` is called to retrieve entities, this</span>
<span class="sd">                will be passed to control entity filtering. Note that</span>
<span class="sd">                this only happens if this entity type hasn&#39;t</span>
<span class="sd">                previously been fetched.</span>

<span class="sd">        This is a wrapper that hides the distinction between entity</span>
<span class="sd">        types like ``ec2`` and ``s3`` that correspond to AWS services</span>
<span class="sd">        and other entity types that don&#39;t.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span>
                <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span> <span class="ow">and</span>
                <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="n">errmsg</span> <span class="o">=</span> <span class="s2">&quot;Unknown entity type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">AWSMediatorError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="p">,</span> <span class="n">use_filters</span>
                    <span class="p">)</span>

            <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_services</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="p">,</span> <span class="n">use_filters</span>
                    <span class="p">)</span>

            <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_other_entities</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">entities</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="AWSMediator.get_aws_info_in_parallel"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSMediator.get_aws_info_in_parallel">[docs]</a>    <span class="k">def</span> <span class="nf">get_aws_info_in_parallel</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">requests</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Use subprocess pools to retrieve multiple data requests in parallel.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            requests (list of dicts):</span>
<span class="sd">                A mapping defining the parameters for the requests</span>
<span class="sd">                in question. The expected key/value pairs include:</span>

<span class="sd">                *origin*</span>
<span class="sd">                    A passback field for the caller to identify to</span>
<span class="sd">                    which entity the data returned for this request</span>
<span class="sd">                    belongs.</span>

<span class="sd">                *client_type*</span>
<span class="sd">                    The type of client needed to handle this request.</span>

<span class="sd">                *client_method*</span>
<span class="sd">                    The client method needed to handle this request.</span>

<span class="sd">                *method_args*, *method_kwargs*</span>
<span class="sd">                    The args and kwargs to pass to the client method.</span>

<span class="sd">                *response_data_keys*</span>
<span class="sd">                    The keys for the items in the method response that</span>
<span class="sd">                    contain the actual data, rather than response</span>
<span class="sd">                    metadata or other information.</span>

<span class="sd">        Returns:</span>

<span class="sd">            A list of pairs [[request, response]...] where each</span>
<span class="sd">            response has the client method return value for this</span>
<span class="sd">            request. Each response will be a dict whose keys are</span>
<span class="sd">            response_data_keys and whose values are the values of</span>
<span class="sd">            those keys in client_method call return dicts.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">pool_size</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PARALLEL_FETCH_PROCESS_COUNT</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">pool_size</span><span class="p">:</span>
            <span class="n">pool_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pool_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">pools</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="n">pool_size</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pools</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_one_request</span><span class="p">,</span> <span class="n">requests</span><span class="p">)</span>
        <span class="n">pools</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span></div></div>


<span class="c1"># TODO: Might be helpful to move the fancy __new__() stuff into a</span>
<span class="c1"># CachableInformer subclass?</span>
<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformer">[docs]</a><span class="k">class</span> <span class="nc">AWSInformer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Manage selected information for specified AWS entities.</span>

<span class="sd">    Arguments:</span>

<span class="sd">        resource (dict):</span>
<span class="sd">            An AWS resource being handled by this informer.</span>

<span class="sd">        profile_name (string):</span>
<span class="sd">            The name of the AWS profile to use for this informer&#39;s</span>
<span class="sd">            mediator.</span>

<span class="sd">        region_name (string):</span>
<span class="sd">            The name of the AWS region to use for this informer&#39;s</span>
<span class="sd">            mediator.</span>

<span class="sd">        mediator (aws_informer.AWSMediator):</span>
<span class="sd">            An AWSMediator instance this resource should use.</span>

<span class="sd">        required_resource_type:</span>
<span class="sd">            The type() of the AWS resource boto class the informer is</span>
<span class="sd">            intended to handle.</span>

<span class="sd">    Attributes:</span>

<span class="sd">        identifier (str): A string which uniquely identifies this</span>
<span class="sd">            informer, appropriate for the entity type. For example,</span>
<span class="sd">            the InstanceID for an EC2InstanceInformer or the</span>
<span class="sd">            LoadBalancerName for an ELBInformer.</span>

<span class="sd">        resource (dict): The original record for the AWS entity this</span>
<span class="sd">            Informer instance manages.</span>

<span class="sd">        expansions (dict):</span>
<span class="sd">            The child resources found when expanding this informer.</span>

<span class="sd">        supplementals (dict):</span>
<span class="sd">            Additional information assigned to this informer.</span>

<span class="sd">        is_expanded (bool):</span>
<span class="sd">            ``True`` if this informer&#39;s ``expand()`` method has been</span>
<span class="sd">            called; ``False`` otherwise.</span>

<span class="sd">        promote_to_top_level (list):</span>
<span class="sd">            A list of top level ``resource`` keys that will be handled</span>
<span class="sd">            specially in ``AWSInformer.to_dict()``. See the</span>
<span class="sd">            documentation for ``to_dict()`` for details.</span>

<span class="sd">        elisions (list):</span>
<span class="sd">            A list of top level ``resource`` keys that will be handled</span>
<span class="sd">            specially in ``AWSInformer.to_dict()``. See the</span>
<span class="sd">            documentation for ``to_dict()`` for details.</span>


<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_require_resource_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Raise an error if the wrong resource type is assigned.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">resource_type</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">AWSInformerResourceTypeError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (expected instance of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">resource</span><span class="p">),</span>
                    <span class="n">resource_type</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_get_init_entity_identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Look up the appropriate key for our class in our resource.&#39;&#39;&#39;</span>

        <span class="n">identifier_key_map</span> <span class="o">=</span> <span class="n">_informer_identifier_key_map</span><span class="p">()</span>
        <span class="n">entity_identifier</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">in</span> <span class="n">identifier_key_map</span><span class="p">:</span>
            <span class="n">entity_identifier_key</span> <span class="o">=</span> <span class="n">identifier_key_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span>
            <span class="n">entity_identifier</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="n">entity_identifier_key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">entity_identifier</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">region_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">mediator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Check if we should create a fresh informer or reuse a cached one.</span>

<span class="sd">        This is only possible if we&#39;re being passed a mediator, rather</span>
<span class="sd">        than a profile and region with which to create one. In this</span>
<span class="sd">        case we check whether the value that will be the new</span>
<span class="sd">        informer&#39;s identifier is a key in the mediator&#39;s</span>
<span class="sd">        informer_cache records, and if so we just re-use that</span>
<span class="sd">        informer.</span>

<span class="sd">        In this case, this __new__() returns the instance found in the</span>
<span class="sd">        informer_cache. Because this instance will be of the child</span>
<span class="sd">        class type, the child class&#39;s __init__() will be called. We</span>
<span class="sd">        don&#39;t want to re-initialize the instance, so all child classes</span>
<span class="sd">        are responsible for checking the mediator&#39;s informer_cache,</span>
<span class="sd">        and only initializing again if they aren&#39;t there. They must</span>
<span class="sd">        also make sure to update the cache by adding themself the</span>
<span class="sd">        first time they&#39;re initialized.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="n">identifier_key_map</span> <span class="o">=</span> <span class="n">_informer_identifier_key_map</span><span class="p">()</span>
        <span class="n">entity_identifier</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">identifier_key_map</span> <span class="ow">and</span> <span class="n">resource</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entity_identifier_key</span> <span class="o">=</span> <span class="n">identifier_key_map</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">entity_identifier</span> <span class="o">=</span> <span class="n">resource</span><span class="p">[</span><span class="n">entity_identifier_key</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> entity identifier key &quot;</span><span class="si">%s</span><span class="s1">&quot; not found in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">err_msg</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">err</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">resource</span><span class="p">))</span>

        <span class="n">no_informer_cache</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">mediator</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="n">entity_identifier</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">no_informer_cache</span><span class="p">:</span>

            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
                <span class="bp">cls</span><span class="p">,</span>
                <span class="n">resource</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">region_name</span><span class="o">=</span><span class="n">region_name</span><span class="p">,</span>
                <span class="n">profile_name</span><span class="o">=</span><span class="n">profile_name</span><span class="p">,</span>
                <span class="n">mediator</span><span class="o">=</span><span class="n">mediator</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mediator</span><span class="o">.</span><span class="n">informer_cache</span><span class="p">[</span><span class="n">entity_identifier</span><span class="p">]</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">region_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">profile_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">mediator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AWSInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;required_resource_type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_require_resource_type</span><span class="p">(</span>
                <span class="n">resource</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;required_resource_type&#39;</span><span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># self.__class__ will identify the child class AWSInformer</span>
        <span class="c1"># that is being initialized.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span> <span class="o">=</span> <span class="n">informer_entity_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span> <span class="o">=</span> <span class="n">region_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span> <span class="o">=</span> <span class="n">profile_name</span>

        <span class="c1"># Child resources stored as Informers.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_expanded</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># TODO: The following should be a method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">mediator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">region_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">profile_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AWSInformerRegionError</span><span class="p">(</span>
                    <span class="s1">&#39;Informer region and profile names&#39;</span>
                    <span class="s1">&#39; or AWS Mediator required&#39;</span>
                    <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span> <span class="o">=</span> <span class="n">AWSMediator</span><span class="p">(</span>
                <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
                <span class="n">profile_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">region_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">region_name</span> <span class="o">!=</span> <span class="n">mediator</span><span class="o">.</span><span class="n">region_name</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Informer region_name </span><span class="si">%s</span><span class="s2"> doesn&#39;t match&quot;</span>
                    <span class="s2">&quot;mediator region_name </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">region_name</span><span class="p">,</span> <span class="n">mediator</span><span class="o">.</span><span class="n">region_name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AWSInformerRegionError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">errmsg</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">profile_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="n">profile_name</span> <span class="o">!=</span> <span class="n">mediator</span><span class="o">.</span><span class="n">profile_name</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Informer profile_name </span><span class="si">%s</span><span class="s2"> doesn&#39;t match&quot;</span>
                    <span class="s2">&quot;mediator profile_name </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">profile_name</span><span class="p">,</span> <span class="n">mediator</span><span class="o">.</span><span class="n">profile_name</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">AWSInformerRegionError</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">errmsg</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span> <span class="o">=</span> <span class="n">mediator</span>

            <span class="c1"># Pass-through sugar.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">region_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">profile_name</span>

        <span class="c1"># Additional records associated with this informer; e.g. the IP</span>
        <span class="c1"># address obtained by DNS lookup on a Load Balancer.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;profile_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">,</span>
                <span class="s1">&#39;region_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
                <span class="s1">&#39;account_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">account_id</span><span class="p">,</span>
                <span class="s1">&#39;account_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">account_name</span><span class="p">,</span>
                <span class="s1">&#39;account_desc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">account_desc</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Structure manipulation control to make things</span>
        <span class="c1"># more manageable when exporting data for viewing</span>
        <span class="c1"># in, e.g., kibana.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="c1"># Fields to map into the top level as dict entries in</span>
        <span class="c1"># to_dict() (and hence JSON) output.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">promote_to_top_level</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">]</span>

        <span class="c1"># # Fields on which to call flatten() when converting to</span>
        <span class="c1"># # to_dict() (and hence JSON) output.</span>
        <span class="c1"># self.flatten = [</span>
        <span class="c1">#     ]</span>

        <span class="c1"># Call local site defined initialization code.</span>
        <span class="n">site_boogio</span><span class="o">.</span><span class="n">informer_site_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entity_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the ``AWSMediator`` entity type for this informer.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">identifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the unique identifier string for this informer.&#39;&#39;&#39;</span>

        <span class="n">identifier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">iclass</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># TODO: Couldn&#39;t we just look up self.__class__ directly</span>
        <span class="c1"># in _informer_identifier_key_map?</span>
        <span class="n">informer_class_map</span> <span class="o">=</span> <span class="n">_entity_type_informer_class_map</span><span class="p">()</span>
        <span class="n">identifier_map</span> <span class="o">=</span> <span class="n">_informer_identifier_key_map</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span> <span class="ow">in</span> <span class="n">informer_class_map</span><span class="p">:</span>
            <span class="n">iclass</span> <span class="o">=</span> <span class="n">informer_class_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_entity_type</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">iclass</span> <span class="ow">in</span> <span class="n">identifier_map</span><span class="p">:</span>
            <span class="n">identifier_key</span> <span class="o">=</span> <span class="n">identifier_map</span><span class="p">[</span><span class="n">iclass</span><span class="p">]</span>
            <span class="n">identifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="n">identifier_key</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">identifier</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformer.to_dict"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformer.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_identifier</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a dict structure using expanded subelements when available.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            entity_identifier (bool, default=False):</span>
<span class="sd">                If ``True``, the dict will include an</span>
<span class="sd">                ``entity_identifier`` field whose value is the</span>
<span class="sd">                entity&#39;s ``identifier`` attribute. If false, the</span>
<span class="sd">                ``entity_identifier`` field won&#39;t be included.</span>

<span class="sd">            flat (bool, default=False):</span>
<span class="sd">                If the ``flat`` parameter is True, the data structure</span>
<span class="sd">                returned will be a list of flattened (no nested</span>
<span class="sd">                structures) dicts. For more information on flattening,</span>
<span class="sd">                see the documentation for ``utensils.flatten``.</span>

<span class="sd">        The result of ``to_dict()`` is guaranteed to be a serializable</span>
<span class="sd">        structure suitable for JSON conversion. If any subentities are</span>
<span class="sd">        encountered that raise an error when converting to JSON, they</span>
<span class="sd">        will be replaced with their string representation</span>
<span class="sd">        via``str()``.</span>

<span class="sd">        The result returned by ``to_dict()`` will include the</span>
<span class="sd">        informer instance information with the following adjustments.</span>

<span class="sd">        *   Any top level keys in the informer&#39;s ``elisions`` list</span>
<span class="sd">            will be omitted from the result of ``to_dict()``. As</span>
<span class="sd">            working with expanded entities can generate significant</span>
<span class="sd">            amounts of data, you may sometimes want to use this to</span>
<span class="sd">            omit unneeded substructures to speed up subsequent</span>
<span class="sd">            processing.</span>

<span class="sd">        *   The ``expansions`` value will replace the ``resource``</span>
<span class="sd">            value for any top level key present in both.</span>

<span class="sd">        *   AWS entities store the names and values of their tags as</span>
<span class="sd">            the value of the ``Key`` and ``Value`` items in a dict. In</span>
<span class="sd">            the structure returned by ``to_dict()``, a tag</span>
<span class="sd">            ``some_tag``</span>

<span class="sd">                ::</span>

<span class="sd">                    &#39;Tags&#39;: {&#39;Key&#39;: &#39;some_tag&#39;, &#39;Value&#39;: &#39;some_value&#39;}</span>

<span class="sd">            will be represented as</span>

<span class="sd">                ::</span>

<span class="sd">                    &#39;Tags:some_tag&#39;: &#39;some_value&#39;</span>

<span class="sd">            at the top level of the returned dict.</span>

<span class="sd">        *   Any keys in the top level of the informer&#39;s resource that</span>
<span class="sd">            are present in the informer&#39;s ``promote_to_top_level``</span>
<span class="sd">            list will be treated similarly to tags. If the value of</span>
<span class="sd">            that key is a dict, it will be replaced with a set of top</span>
<span class="sd">            level entries. For example, if ``TopKey`` appears in the</span>
<span class="sd">            ``promote_to_top_level`` list, then the top level item</span>

<span class="sd">                ::</span>

<span class="sd">                    &#39;TopKey&#39;: {&#39;Key1&#39;: &#39;Val1&#39;, &#39;Key2&#39;: &#39;Val2&#39;}</span>

<span class="sd">            will be replaced with the top level items</span>

<span class="sd">                ::</span>

<span class="sd">                    &#39;TopKey:Key1&#39;: &#39;Val1&#39;</span>
<span class="sd">                    &#39;TopKey:Key2&#39;: &#39;Val2&#39;</span>

<span class="sd">            at the top level of the returned dict.</span>

<span class="sd">            Note that this will raise an error if the value to be</span>
<span class="sd">            promoted isn&#39;t a dict.</span>

<span class="sd">        *   The resulting dict will be updated with the items in the</span>
<span class="sd">            informer&#39;s ``supplementals`` dict. If any of these are</span>
<span class="sd">            themselves informers, their ``to_dict()`` method will be</span>
<span class="sd">            called.</span>

<span class="sd">        *   The resulting dict will be flat if the ``flat`` argument</span>
<span class="sd">            is ``True``.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># TODO: Add _dict_cache attribute and only update the</span>
        <span class="c1"># supplementals and expansions when to_dict() is called.</span>

        <span class="c1"># TODO: keep a list of informer identifiers already</span>
        <span class="c1"># encountered (including the top level) to avoid loops. This</span>
        <span class="c1"># should be a stack, and increase/decrease as we go up and</span>
        <span class="c1"># down.</span>

        <span class="c1"># pylint: disable=too-many-branches</span>

        <span class="n">as_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">entity_identifier</span><span class="p">:</span>
            <span class="n">as_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;entity_identifier&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="p">}</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Some Informers store the AWS entity representation in their</span>
        <span class="c1"># meta.data dict attribute; others are just a dict comtaining the</span>
        <span class="c1"># AWS entity representation.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">resource_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resource_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">resource_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;unknown resource type in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Any value we add here to as_dict is either the result of calling</span>
        <span class="c1"># as_dict on a subordinate resource or has been ensured to be JSON</span>
        <span class="c1"># serializable in the else clause.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">resource_dict</span><span class="p">:</span>

            <span class="c1"># TODO: Really should leave tags and promotes alone here</span>
            <span class="c1"># if we&#39;re not flattening.</span>

            <span class="c1"># TODO: Do we need all this deepcopying?</span>

            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="c1"># Tags need to be moved to the top level for, e.g.,</span>
            <span class="c1"># ElasticSearch indexing., but they have a substructure we have</span>
            <span class="c1"># to massage separately from the generic &quot;move to top level&quot;</span>
            <span class="c1"># elements.</span>
            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;Tags&#39;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">tag_item</span> <span class="ow">in</span> <span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>

                    <span class="n">this_tag_key</span> <span class="o">=</span> <span class="s1">&#39;Tags:&#39;</span> <span class="o">+</span> <span class="n">tag_item</span><span class="p">[</span><span class="s1">&#39;Key&#39;</span><span class="p">]</span>
                    <span class="n">this_tag_value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tag_item</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>

                    <span class="k">if</span> <span class="n">this_tag_key</span> <span class="ow">in</span> <span class="n">as_dict</span><span class="p">:</span>

                        <span class="c1"># We already have at least one value for this tag.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">as_dict</span><span class="p">[</span><span class="n">this_tag_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_tag_value</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="c1"># It was only one value, not a list yet.</span>
                            <span class="n">as_dict</span><span class="p">[</span><span class="n">this_tag_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">as_dict</span><span class="p">[</span><span class="n">this_tag_key</span><span class="p">]</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_tag_value</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">as_dict</span><span class="p">[</span><span class="n">this_tag_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_tag_value</span>

                <span class="k">continue</span>

            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="c1"># Move key-value pairs from items in the value of specified</span>
            <span class="c1"># resource entries to top level items in the resource itself,</span>
            <span class="c1"># for better accessibility in, e.g., ElasticSearch indexing.</span>
            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">promote_to_top_level</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">child_key</span> <span class="ow">in</span> <span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>

                    <span class="n">top_level_key</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">child_key</span>
                    <span class="n">top_level_value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                        <span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">child_key</span><span class="p">]</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">top_level_key</span> <span class="ow">in</span> <span class="n">as_dict</span><span class="p">:</span>

                        <span class="c1"># We already have at least one value for this tag.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">as_dict</span><span class="p">[</span><span class="n">top_level_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_level_value</span><span class="p">)</span>

                        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                            <span class="c1"># It was only one value, not a list yet.</span>
                            <span class="n">as_dict</span><span class="p">[</span><span class="n">top_level_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="n">as_dict</span><span class="p">[</span><span class="n">top_level_key</span><span class="p">]</span>
                                <span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">top_level_value</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">as_dict</span><span class="p">[</span><span class="n">top_level_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_level_value</span>

                <span class="k">continue</span>

            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="c1"># Use expansions if available.</span>
            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">:</span>
                <span class="c1"># as_dict[key] = self._expansion_to_container(key)</span>
                <span class="n">expansion</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">expansion</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="c1"># Must have been a list.</span>
                    <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">informer</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">informer</span> <span class="ow">in</span> <span class="n">expansion</span>
                        <span class="p">]</span>

            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="c1"># This subentity wasn&#39;t expanded, so we&#39;ll use the original value</span>
            <span class="c1"># in the resource. If it&#39;s not serializable, we&#39;ll replace it with</span>
            <span class="c1"># a representation as a string.</span>
            <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># We just want to see if this will raise an exception, we</span>
                    <span class="c1"># don&#39;t want the actual value.</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="c1"># return str(type(value).__name__)</span>
                    <span class="c1"># as_dict[key] = str(</span>
                    <span class="c1">#     type(resource_dict[key]).__name__</span>
                    <span class="c1">#     )</span>
                    <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">resource_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">:</span>
            <span class="c1"># Make sure we didn&#39;t accidentally clobber a resource/expansion</span>
            <span class="c1"># field.</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">as_dict</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> supplementals contains a duplicate&#39;</span>
                    <span class="s1">&#39; of an informer key: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="p">)</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">AWSInformer</span><span class="p">):</span>
                <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">as_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># Now as_dict[key] holds the &quot;unmassaged&quot; data for this key. We&#39;ll</span>
        <span class="c1"># flatten lists for this entity and massage accordingly.</span>
        <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
            <span class="c1"># 20170411: There&#39;s a bug (?) in flatten, if a dict has</span>
            <span class="c1"># any item at any level whose value is {}, the whole</span>
            <span class="c1"># flattening will be an empty list.</span>
            <span class="n">as_dict</span> <span class="o">=</span> <span class="n">flatten</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">as_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">as_dict</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformer.json_dumps"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformer.json_dumps">[docs]</a>    <span class="k">def</span> <span class="nf">json_dumps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Return a JSON representation of the informer.</span>

<span class="sd">        Arguments:</span>

<span class="sd">            flat (bool):</span>
<span class="sd">                If the ``flat`` parameter is True, the data structure</span>
<span class="sd">                returned will be a list of flattened (no nested</span>
<span class="sd">                structures) dicts obtained by calling the informer&#39;s</span>
<span class="sd">                ``to_dict()`` method with ``flat=True``.</span>

<span class="sd">                For more information on flattening, see the</span>
<span class="sd">                documentation for ``utensils.flatten``.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">flat</span><span class="o">=</span><span class="n">flat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AWSInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AWSInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details and populate the expansions attribute.</span>

<span class="sd">        The expansions attribute is a dictionary whose keys match the</span>
<span class="sd">        name of some attribute of the ``resource`` attribute, and</span>
<span class="sd">        whose values are either AWSInformer instances or lists of</span>
<span class="sd">        AWSInformer instances.</span>

<span class="sd">        Expanding an informer pulls the records from AWS (via the</span>
<span class="sd">        informer&#39;s mediator) for other AWS entities only referenced</span>
<span class="sd">        by id in the original resource record.</span>

<span class="sd">        Each AWSInformer instance in the expansions will in turn be</span>
<span class="sd">        expanded.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># TODO: The mediator, or somewhere, should maintain a master</span>
        <span class="c1"># list of informers so we don&#39;t get copies all over the place.</span>

        <span class="c1"># Doing things this way will work as long as each value in the</span>
        <span class="c1"># expansions dict is either an informer or a list of informers.</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">:</span>
            <span class="n">informer_or_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">informer_or_list</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">inf</span> <span class="ow">in</span> <span class="n">informer_or_list</span><span class="p">:</span>
                    <span class="n">inf</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_expanded</span> <span class="o">=</span> <span class="kc">True</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="ELBInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.ELBInformer">[docs]</a><span class="k">class</span> <span class="nc">ELBInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an ELB resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="ELBInformer.get_dns_address_info"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.ELBInformer.get_dns_address_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_dns_address_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dns_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Use a socket library DNS call to get the address for dns_name.&#39;&#39;&#39;</span>

        <span class="n">addresses</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">addr_info</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="n">dns_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">saddr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">addr_info</span><span class="p">:</span>
                <span class="n">addresses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">saddr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># except socket.gaierror as exc:</span>
        <span class="c1"># TODO: Retry.</span>
        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
            <span class="c1"># raise RuntimeError(</span>
            <span class="c1">#     &#39;Error in socket.getaddrinfo for %s&#39; % dns_name</span>
            <span class="c1">#     )</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Different parameters to getaddrinfo may return the same</span>
        <span class="c1"># IP Address, so we remove duplicates here.</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">addresses</span><span class="p">))</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an ELBInformer instance.</span>

<span class="sd">        See the documentation for _prevent_duplicate_informer_init_if_cached</span>
<span class="sd">        as well.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ELBInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="ELBInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.ELBInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Resources stored by reference in this resource.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="k">if</span> <span class="s1">&#39;SecurityGroups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;SecurityGroups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SecurityGroupInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;security_group&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;SecurityGroups&#39;</span><span class="p">]</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;VPCId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">vpc_list_reduced</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">VPCInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;vpc&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;VPCId&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vpc_list_reduced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;VPCId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpc_list_reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;Subnets&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;Subnets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SubnetInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;subnet&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Subnets&#39;</span><span class="p">]</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;Instances&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">resource_instance_ids</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Instances&#39;</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;Instances&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">EC2InstanceInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">resource_instance_ids</span>
                <span class="p">]</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Look up the IP addresses for this ELBs DNS name.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;DNSIpAddress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;INET&#39;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">if</span> <span class="s1">&#39;DNSName&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">():</span>
            <span class="n">dns_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="s1">&#39;DNSName&#39;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;DNSIpAddress&#39;</span><span class="p">][</span><span class="s1">&#39;INET&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_dns_address_info</span><span class="p">(</span><span class="n">dns_name</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># This must be after the expansions list is populated, as it</span>
        <span class="c1"># calls expand() in each element of the list.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ELBInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EMRInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EMRInformer">[docs]</a><span class="k">class</span> <span class="nc">EMRInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an EMR resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an EMRInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EMRInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EMRInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EMRInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># EMR resources add additional fields upon expansion.</span>
        <span class="n">cluster_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">]</span>

        <span class="c1"># Watch for throttling issues. Start with 20 msec backoff if needed.</span>
        <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">initial_backoff</span> <span class="o">=</span> <span class="o">.</span><span class="mi">02</span>
        <span class="n">backoff_growth</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="n">backoff</span> <span class="o">=</span> <span class="n">initial_backoff</span>
        <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">12</span>

        <span class="k">while</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;emr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">describe_cluster</span><span class="p">(</span>
                    <span class="n">ClusterId</span><span class="o">=</span><span class="n">cluster_id</span>
                    <span class="p">)[</span><span class="s1">&#39;Cluster&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="n">botocore</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ClientError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">retries</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">backoff</span><span class="p">)</span>
                <span class="n">retries</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">backoff</span> <span class="o">*=</span> <span class="n">backoff_growth</span> <span class="o">**</span> <span class="n">retries</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>

        <span class="c1"># This must be after the expansions list is populated, as it</span>
        <span class="c1"># calls expand() in each element of the list.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EMRInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EC2InstanceInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EC2InstanceInformer">[docs]</a><span class="k">class</span> <span class="nc">EC2InstanceInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an EC2 Instance resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an EC2InstanceInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EC2InstanceInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">promote_to_top_level</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;Placement&#39;</span>
            <span class="p">]</span>

        <span class="c1"># The NetworkInterface elements, although they also have their</span>
        <span class="c1"># own AWSInformer class, come completely defined as</span>
        <span class="c1"># subelements of the EC2InstanceInformer resource. They have</span>
        <span class="c1"># a non-serializable datetime type as their AttachTime value,</span>
        <span class="c1"># which we replace here with a string representation. This is</span>
        <span class="c1"># also done in NetworkInterfaceInformer class instance</span>
        <span class="c1"># initialization where we also provide an attach_datetime</span>
        <span class="c1"># property preserving the original value.</span>
        <span class="c1"># TODO: This special handling needs test cases.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nif</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaces&#39;</span><span class="p">]:</span>
                <span class="n">attachment</span> <span class="o">=</span> <span class="n">nif</span><span class="p">[</span><span class="s1">&#39;Attachment&#39;</span><span class="p">]</span>
                <span class="n">attachment</span><span class="p">[</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">attachment</span><span class="p">[</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                        <span class="n">DEFAULT_UTC_TIMESTAMP_FORMAT</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If the dict references fail, there&#39;s nothing to convert.</span>
            <span class="k">pass</span>

        <span class="c1"># Also true of BlockDeviceMappings.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mapping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;BlockDeviceMappings&#39;</span><span class="p">]:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;Ebs&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;AttachTime&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">device</span><span class="p">[</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span>
                        <span class="n">DEFAULT_UTC_TIMESTAMP_FORMAT</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># If the dict references fail, there&#39;s nothing to convert.</span>
            <span class="k">pass</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EC2InstanceInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EC2InstanceInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Resources stored by reference in this resource.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="k">if</span> <span class="s1">&#39;SecurityGroups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;SecurityGroups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SecurityGroupInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;security_group&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">sg</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;SecurityGroups&#39;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;NetworkInterfaces&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">NetworkInterfaceInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;network_interface&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">ni</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaces&#39;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;VpcId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">vpc_list_reduced</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">VPCInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;vpc&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vpc_list_reduced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpc_list_reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;SubnetId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">subnet_list_reduced</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SubnetInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;subnet&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subnet_list_reduced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subnet_list_reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EC2InstanceInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SecurityGroupInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SecurityGroupInformer">[docs]</a><span class="k">class</span> <span class="nc">SecurityGroupInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for a SecurityGroup resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a SecurityGroupInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SecurityGroupInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># We add a &quot;PortRange&quot; item to the IPPermissions for ease of</span>
        <span class="c1"># reference later.</span>
        <span class="k">for</span> <span class="n">permtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;IpPermissions&#39;</span><span class="p">,</span> <span class="s1">&#39;IpPermissionsEgress&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">permtype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="n">permtype</span><span class="p">]:</span>
                    <span class="n">port_range</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="s1">&#39;FromPort&#39;</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">:</span>
                        <span class="n">port_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">perm</span><span class="p">[</span><span class="s1">&#39;FromPort&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="s1">&#39;ToPort&#39;</span> <span class="ow">in</span> <span class="n">perm</span> <span class="ow">and</span> <span class="n">perm</span><span class="p">[</span><span class="s1">&#39;ToPort&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">perm</span><span class="p">[</span><span class="s1">&#39;FromPort&#39;</span><span class="p">]:</span>
                        <span class="n">port_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">perm</span><span class="p">[</span><span class="s1">&#39;ToPort&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">port_range</span><span class="p">:</span>
                        <span class="n">perm</span><span class="p">[</span><span class="s1">&#39;PortRange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">port_range</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">perm</span><span class="p">[</span><span class="s1">&#39;PortRange&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SecurityGroupInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SecurityGroupInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># self.expansions[&#39;IpPermissions&#39;] = [</span>
        <span class="c1">#     IpPermissionsInformer(x, mediator=self.mediator)</span>
        <span class="c1">#     for x in self.resource[&#39;IpPermissions&#39;]</span>
        <span class="c1">#     ]</span>

        <span class="c1"># self.expansions[&#39;IpPermissionsEgress&#39;] = [</span>
        <span class="c1">#     IpPermissionsInformer(x, mediator=self.mediator)</span>
        <span class="c1">#     for x in self.resource[&#39;IpPermissionsEgress&#39;]</span>
        <span class="c1">#     ]</span>

        <span class="k">if</span> <span class="s1">&#39;VpcId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">vpc_list_reduced</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">VPCInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;vpc&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vpc_list_reduced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpc_list_reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># This must be after the expansions list is populated, as it</span>
        <span class="c1"># calls expand() in each element of the list.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SecurityGroupInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="VPCInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.VPCInformer">[docs]</a><span class="k">class</span> <span class="nc">VPCInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for a VPC resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a VPCInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VPCInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># Add supplementals for peering connections.</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="VPCInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.VPCInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VPCInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="VpcPeeringConnectionInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.VpcPeeringConnectionInformer">[docs]</a><span class="k">class</span> <span class="nc">VpcPeeringConnectionInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage information retrieval for a VPC Peering Connection resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a VpcPeeringConnectionInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VpcPeeringConnectionInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># Add supplementals for peering connections.</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="VpcPeeringConnectionInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.VpcPeeringConnectionInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">VpcPeeringConnectionInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="InternetGatewayInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.InternetGatewayInformer">[docs]</a><span class="k">class</span> <span class="nc">InternetGatewayInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage information retrieval for an Internet Gateway resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an InternetGatewayInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InternetGatewayInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># Add supplementals for internet gateways.</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="InternetGatewayInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.InternetGatewayInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InternetGatewayInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NatGatewayInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NatGatewayInformer">[docs]</a><span class="k">class</span> <span class="nc">NatGatewayInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage information retrieval for a NAT Gateway resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a NatGatewayInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NatGatewayInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># Add supplementals for nat gateways.</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NatGatewayInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NatGatewayInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NatGatewayInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AutoScalingGroupInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AutoScalingGroupInformer">[docs]</a><span class="k">class</span> <span class="nc">AutoScalingGroupInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an AutoScalingGroup resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an AutoScalingGroupInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AutoScalingGroupInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="AutoScalingGroupInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.AutoScalingGroupInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AutoScalingGroupInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SubnetInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SubnetInformer">[docs]</a><span class="k">class</span> <span class="nc">SubnetInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for a Subnet resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a SubnetInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SubnetInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SubnetInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SubnetInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SubnetInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>

        <span class="k">if</span> <span class="s1">&#39;VpcId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="n">vpc_list_reduced</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">VPCInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;vpc&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vpc_list_reduced</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;VpcId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vpc_list_reduced</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NetworkInterfaceInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NetworkInterfaceInformer">[docs]</a><span class="k">class</span> <span class="nc">NetworkInterfaceInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an EC2 Network Interface resource.&#39;&#39;&#39;</span>

    <span class="n">timestamp_format</span> <span class="o">=</span> <span class="n">DEFAULT_UTC_TIMESTAMP_FORMAT</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a NetworkInterfaceInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NetworkInterfaceInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attach_datetime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># These have un-serializable datetime entities that need to</span>
        <span class="c1"># be converted to strings now.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attach_datetime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Attachment&#39;</span><span class="p">][</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Attachment&#39;</span><span class="p">][</span><span class="s1">&#39;AttachTime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_attach_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_format</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attach_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the original datetime type attach time.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attach_datetime</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NetworkInterfaceInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NetworkInterfaceInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;Groups&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;Groups&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SecurityGroupInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;security_group&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">sg</span><span class="p">[</span><span class="s1">&#39;GroupId&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Groups&#39;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NetworkInterfaceInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NetworkAclInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NetworkAclInformer">[docs]</a><span class="k">class</span> <span class="nc">NetworkAclInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an EC2 Network ACL resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a NetworkAclInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NetworkAclInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># We add a &quot;PortRangeDesc&quot; item to the Entries for ease of</span>
        <span class="c1"># reference later.</span>
        <span class="c1"># TODO: SecurityGroupInformer should use PortRangeDesc, not PortRange.</span>
        <span class="c1"># TODO: This isn&#39;t tested.</span>
        <span class="k">if</span> <span class="s1">&#39;Entries&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Entries&#39;</span><span class="p">]:</span>

                <span class="n">port_range_desc</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">if</span> <span class="s1">&#39;PortRange&#39;</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>

                    <span class="n">port_range</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;PortRange&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="s1">&#39;From&#39;</span> <span class="ow">in</span> <span class="n">port_range</span><span class="p">:</span>
                        <span class="n">port_range_desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">port_range</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="s1">&#39;To&#39;</span> <span class="ow">in</span> <span class="n">port_range</span> <span class="ow">and</span>
                            <span class="n">port_range</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">port_range</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span>
                            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                        <span class="n">port_range_desc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">port_range</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">port_range_desc</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;PortRangeDesc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">port_range_desc</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;PortRangeDesc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0-65535&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="NetworkAclInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.NetworkAclInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s1">&#39;Associations&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansions</span><span class="p">[</span><span class="s1">&#39;AssociatedSubnets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">SubnetInformer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;subnet&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">association</span><span class="p">[</span><span class="s1">&#39;SubnetId&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">association</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Associations&#39;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">NetworkAclInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="RouteTableInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.RouteTableInformer">[docs]</a><span class="k">class</span> <span class="nc">RouteTableInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for Route Table resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize a RouteTableInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RouteTableInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="RouteTableInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.RouteTableInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># if &#39;Associations&#39; in self.resource:</span>
        <span class="c1">#     self.expansions[&#39;AssociatedSubnets&#39;] = [</span>
        <span class="c1">#         SubnetInformer(x, mediator=self.mediator)</span>
        <span class="c1">#         for x in self.mediator.entities(&#39;subnet&#39;)</span>
        <span class="c1">#         if x[&#39;SubnetId&#39;] in [</span>
        <span class="c1">#             association[&#39;SubnetId&#39;]</span>
        <span class="c1">#             for association in self.resource[&#39;Associations&#39;]</span>
        <span class="c1">#             ]</span>
        <span class="c1">#         ]</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">RouteTableInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EIPInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EIPInformer">[docs]</a><span class="k">class</span> <span class="nc">EIPInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for an Elastic IP resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an EIPInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EIPInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="EIPInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.EIPInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">EIPInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>

        <span class="c1"># - - - - - - - - - - - - - - - -</span>
        <span class="k">if</span> <span class="s1">&#39;InstanceId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]:</span>
            <span class="n">instance_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span>
            <span class="n">instance_entity</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;InstanceId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">instance_id</span>
                <span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance_entity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">instance_entity</span> <span class="o">=</span> <span class="n">instance_entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;EC2Instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">EC2InstanceInformer</span><span class="p">(</span><span class="n">instance_entity</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;EC2Instance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># - - - - - - - - - - - - - - - -</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s1">&#39;NetworkInterfaceId&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">]</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="n">nif_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">]</span>
            <span class="n">nif_entity</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">entities</span><span class="p">(</span><span class="s1">&#39;network_interface&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;NetworkInterfaceId&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nif_id</span>
                <span class="p">]</span>
            <span class="c1"># TODO: This fails sometimes - dying instance maybe?</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nif_entity</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">nif_entity</span> <span class="o">=</span> <span class="n">nif_entity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;NetworkInterface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">NetworkInterfaceInformer</span><span class="p">(</span>
                    <span class="n">nif_entity</span><span class="p">,</span> <span class="n">mediator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mediator</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="s1">&#39;NetworkInterface&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SQSInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SQSInformer">[docs]</a><span class="k">class</span> <span class="nc">SQSInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Manage selected information for a SQS resource.&#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="nd">@_prevent_duplicate_informer_init_if_cached</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an SQSInformer instance.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SQSInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">resource</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;sqs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;QueueURL&#39;</span><span class="p">]</span>
                <span class="p">)</span><span class="o">.</span><span class="n">attributes</span>
            <span class="p">)</span>

        <span class="c1"># Policy comes to us as JSON which we want to convert.</span>
        <span class="k">if</span> <span class="s1">&#39;Policy&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Policy&#39;</span><span class="p">]</span>
                <span class="p">)</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="SQSInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SQSInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">SQSInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_get_region_from_arn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arnstr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper method for getting region from arn.</span>

<span class="sd">        The region should be the fourth colon-separated field in the</span>
<span class="sd">        arn. If this is ever not the case, an assertion will fail.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">region</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># print &quot;arnstr is&quot;, arnstr</span>
        <span class="c1"># if isinstance(arnstr, unicode):</span>

        <span class="c1"># &quot;arn:aws:sns:sa-east-1:999999999999:dev-cloudtrail&quot;</span>
        <span class="n">arn_parts</span> <span class="o">=</span> <span class="n">arnstr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arn_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arn_parts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">arn_parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">region</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">_get_arns_from_policy_statement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_statement</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Helper method for policy_statement_regions.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">policy_statement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># This is the SourceArn that we are trying to retrieve (us-east-1)</span>
        <span class="c1"># &quot;Condition&quot;: {</span>
        <span class="c1">#    &quot;ArnEquals&quot;: {</span>
        <span class="c1">#   &quot;aws:SourceArn&quot;: [</span>
        <span class="c1">#   &quot;arn:aws:sns:sa-east-1:999999999999:dev-cloudtrail&quot;,</span>
        <span class="c1">#   &quot;arn:aws:sns:ap-southeast-2:999999999999:dev-cloudtrail&quot;,</span>
        <span class="c1">#  &quot;arn:aws:sns:ap-northeast-1:999999999999:dev-cloudtrail&quot;,</span>
        <span class="c1">#  &quot;arn:aws:sns:us-west-2:999999999999:dev-cloudtrail&quot;,</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s1">&#39;Condition&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">policy_statement</span> <span class="ow">or</span>
                <span class="s1">&#39;ArnEquals&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">policy_statement</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="s1">&#39;aws:SourceArn&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">policy_statement</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">][</span><span class="s1">&#39;ArnEquals&#39;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># u&#39;aws:SourceArn&#39;: u&#39;arn:aws:sns:us-east-1:999999999999:dev-cloud*</span>
        <span class="n">arns</span> <span class="o">=</span> <span class="n">policy_statement</span><span class="p">[</span><span class="s1">&#39;Condition&#39;</span><span class="p">][</span><span class="s1">&#39;ArnEquals&#39;</span><span class="p">][</span><span class="s1">&#39;aws:SourceArn&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">arns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arns</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">arns</span> <span class="o">=</span> <span class="p">[</span><span class="n">arns</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arns</span><span class="p">]))</span> <span class="o">==</span> <span class="p">[</span><span class="n">unicode</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">arns</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="c1"># We treat each queue as a separate resource, where AWS keeps all of the</span>
    <span class="c1">#    queues in a single list that is retrieved with the session</span>
    <span class="c1">#   resource(&#39;sqs&#39;) Queue() method. This block populates the details of</span>
    <span class="c1">#   this particular informer with the attributes of the appropriate queue</span>
    <span class="c1">#   in that session resource list</span>
    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>

<div class="viewcode-block" id="SQSInformer.get_subscribed_sns_topic_regions"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.SQSInformer.get_subscribed_sns_topic_regions">[docs]</a>    <span class="k">def</span> <span class="nf">get_subscribed_sns_topic_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pylint: disable=invalid-name</span>
        <span class="sd">&#39;&#39;&#39;Return the SNS topic regions in the instance&#39;s subscribed topics.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="s1">&#39;Policy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="ow">or</span>
                <span class="s1">&#39;Statement&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Policy&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Policy&#39;</span><span class="p">][</span><span class="s1">&#39;Statement&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">arns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">policy_statement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="p">[</span><span class="s1">&#39;Policy&#39;</span><span class="p">][</span><span class="s1">&#39;Statement&#39;</span><span class="p">]:</span>
            <span class="n">arns</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_arns_from_policy_statement</span><span class="p">(</span><span class="n">policy_statement</span><span class="p">)</span>
        <span class="n">regions</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_region_from_arn</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arns</span><span class="p">]</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regions</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]))</span></div></div>


<span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="IAMInformer"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.IAMInformer">[docs]</a><span class="k">class</span> <span class="nc">IAMInformer</span><span class="p">(</span><span class="n">AWSInformer</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Manage selected information for an Elastic IP resource.</span>

<span class="sd">    IAMInformers have no resource, and store all their data in their</span>
<span class="sd">    supplementals. Typically only one IAMInformer need be instantiated</span>
<span class="sd">    for a given environment.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Initialize an IAMInformer instance.&#39;&#39;&#39;</span>
        <span class="c1"># The parent AWSInformer init requires resource as the second</span>
        <span class="c1"># parameter.</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IAMInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">required_resource_type</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># We don&#39;t set an identifier for IAMInformers.</span>

        <span class="c1"># IAM entities aren&#39;t regionized, so we override the region_name</span>
        <span class="c1"># if it was set in the super __init__().</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">region_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="p">{</span><span class="s1">&#39;record_types&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
            <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># S == covered with special handling.</span>
        <span class="c1"># C == covered with common handling.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># S list_access_keys()</span>
        <span class="c1"># C list_account_aliases()</span>
        <span class="c1"># S list_attached_group_policies()</span>
        <span class="c1"># S list_attached_role_policies()</span>
        <span class="c1"># S list_attached_user_policies()</span>
        <span class="c1"># S list_entities_for_policy()</span>
        <span class="c1"># S list_group_policies()</span>
        <span class="c1"># C list_groups()</span>
        <span class="c1"># S list_groups_for_user()</span>
        <span class="c1"># C list_instance_profiles()</span>
        <span class="c1"># S list_instance_profiles_for_role()</span>
        <span class="c1"># C list_mfa_devices()</span>
        <span class="c1"># C list_open_id_connect_providers()</span>
        <span class="c1"># C list_policies()</span>
        <span class="c1"># S list_policy_versions()</span>
        <span class="c1"># S list_role_policies()</span>
        <span class="c1"># C list_roles()</span>
        <span class="c1"># C list_saml_providers()</span>
        <span class="c1"># C list_server_certificates()</span>
        <span class="c1"># C list_signing_certificates()</span>
        <span class="c1"># C list_ssh_public_keys()</span>
        <span class="c1"># S list_user_policies()</span>
        <span class="c1"># C list_users()</span>
        <span class="c1"># C list_virtual_mfa_devices()</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;iam&#39;</span><span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Common handling</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># pylint: disable=invalid-name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">available_record_type_retrievers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;AccountAliases&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_account_aliases</span><span class="p">,</span>
            <span class="s1">&#39;Groups&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_groups</span><span class="p">,</span>
            <span class="s1">&#39;InstanceProfiles&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_instance_profiles</span><span class="p">,</span>
            <span class="s1">&#39;MFADevices&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_mfa_devices</span><span class="p">,</span>
            <span class="s1">&#39;OpenIDConnectProviderList&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_open_id_connect_providers</span><span class="p">,</span>
            <span class="s1">&#39;Policies&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_policies</span><span class="p">,</span>
            <span class="s1">&#39;Roles&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_roles</span><span class="p">,</span>
            <span class="s1">&#39;SAMLProviderList&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_saml_providers</span><span class="p">,</span>
            <span class="s1">&#39;ServerCertificateMetadataList&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_server_certificates</span><span class="p">,</span>
            <span class="s1">&#39;Certificates&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_signing_certificates</span><span class="p">,</span>
            <span class="s1">&#39;SSHPublicKeys&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_ssh_public_keys</span><span class="p">,</span>
            <span class="s1">&#39;Users&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_users</span><span class="p">,</span>
            <span class="s1">&#39;VirtualMFADevices&#39;</span><span class="p">:</span> <span class="n">client</span><span class="o">.</span><span class="n">list_virtual_mfa_devices</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">record_types</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;record_types&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requested_record_type_retrievers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="c1"># pylint: disable=unsupported-membership-test</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">available_record_type_retrievers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_types</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_types</span>
            <span class="p">}</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Parallel retrieval of the &quot;Common Handling&quot; data items.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
        <span class="n">record_requests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_for_method_response_for_originator</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requested_record_type_retrievers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">request_response_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">get_aws_info_in_parallel</span><span class="p">(</span>
                <span class="n">record_requests</span>
                <span class="p">):</span>
            <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">request_response_err</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;response_data_keys&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1"># for (key, method) in self.requested_record_type_retrievers.items():</span>
        <span class="c1">#     self.supplementals[key] = get_paged_data(method, key)[key]</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
    <span class="c1"># Helper methods for retrieving IAM data in multiple parallel</span>
    <span class="c1"># calls.</span>
    <span class="c1">#</span>
    <span class="c1"># We need to pass quite a few parameters in the request dict so</span>
    <span class="c1"># that the subprocesses can reconstruct the appropriate session</span>
    <span class="c1"># client and call the right method with the necessary</span>
    <span class="c1"># parameters. We&#39;ll pass a list of requests, one for each IAM</span>
    <span class="c1"># User/Group/Role/etc for which we need a method call to</span>
    <span class="c1"># retrieve details, to be handled by a pool of subprocesses.</span>
    <span class="c1">#</span>
    <span class="c1"># The return value from the subprocess pool will again be a list</span>
    <span class="c1"># of [request, response, err] which should be in 1-1 ordered</span>
    <span class="c1"># correspondance with the list of requests we sent. We include</span>
    <span class="c1"># each request in its corresponding response for ease of</span>
    <span class="c1"># correlation.</span>
    <span class="c1">#</span>
    <span class="c1"># If any error was raised somewhere down in the call sequence,</span>
    <span class="c1"># response will be None and err will hold the Exception object</span>
    <span class="c1"># that was raised.</span>
    <span class="c1">#</span>
    <span class="c1"># If no error was raised, err will be None.</span>
    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
    <span class="c1"># pylint: disable=invalid-name</span>
<div class="viewcode-block" id="IAMInformer.request_for_method_response_for_originator"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.IAMInformer.request_for_method_response_for_originator">[docs]</a>    <span class="k">def</span> <span class="nf">request_for_method_response_for_originator</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">originator</span><span class="p">,</span>
            <span class="n">origin_id_key</span><span class="p">,</span>
            <span class="n">client_method</span><span class="p">,</span>
            <span class="n">response_data_keys</span><span class="p">,</span>
            <span class="n">method_id_key</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Construct the request parameters dict for one request.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">method_id_key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method_id_key</span> <span class="o">=</span> <span class="n">origin_id_key</span>
        <span class="n">method_kwargs</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">method_id_key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">method_id_key</span><span class="p">:</span> <span class="n">originator</span><span class="p">[</span><span class="n">origin_id_key</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="n">originator</span><span class="p">,</span>
            <span class="s1">&#39;session_kwargs&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">_session_kwargs</span><span class="p">(),</span>
            <span class="c1"># &#39;session_kwargs&#39;: {</span>
            <span class="c1">#     &#39;profile_name&#39;: self.mediator.session.profile_name</span>
            <span class="c1">#     },</span>
            <span class="s1">&#39;client_type&#39;</span><span class="p">:</span> <span class="s1">&#39;iam&#39;</span><span class="p">,</span>
            <span class="s1">&#39;client_method&#39;</span><span class="p">:</span> <span class="n">client_method</span><span class="p">,</span>
            <span class="s1">&#39;method_args&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;method_kwargs&#39;</span><span class="p">:</span> <span class="n">method_kwargs</span><span class="p">,</span>
            <span class="s1">&#39;response_data_keys&#39;</span><span class="p">:</span> <span class="n">response_data_keys</span>
            <span class="p">}</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="IAMInformer.update_originator_with_response"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.IAMInformer.update_originator_with_response">[docs]</a>    <span class="k">def</span> <span class="nf">update_originator_with_response</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">origin_index</span><span class="p">,</span>
            <span class="n">origin_id_key</span><span class="p">,</span>
            <span class="n">request_response_err</span>
            <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
        <span class="sd">&#39;&#39;&#39;Update the appropriate originator with data from one response.&#39;&#39;&#39;</span>
        <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">request_response_err</span>
        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># print &quot;%s: %s&quot; % (type(err), str(err))</span>
            <span class="k">raise</span> <span class="n">err</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">origin_id</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">][</span><span class="n">origin_id_key</span><span class="p">]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">data_key</span><span class="p">,</span> <span class="n">origin_key</span><span class="p">)</span> <span class="ow">in</span> <span class="n">request</span><span class="p">[</span>
                    <span class="s1">&#39;response_data_keys&#39;</span>
                    <span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">data_key</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                    <span class="n">origin_index</span><span class="p">[</span><span class="n">origin_id</span><span class="p">][</span><span class="n">origin_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span>
                        <span class="n">data_key</span>
                        <span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="s1">&#39;Expected </span><span class="si">%s</span><span class="s1"> key in response: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">data_key</span><span class="p">,</span> <span class="n">response</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s1">&#39;Expected iterable in response: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">response</span>
                <span class="p">)</span></div>

    <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span>
<div class="viewcode-block" id="IAMInformer.expand"><a class="viewcode-back" href="../../boogio.aws_informer.html#boogio.aws_informer.IAMInformer.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch selected entity details.&#39;&#39;&#39;</span>

        <span class="c1"># client = self.mediator.session.client(&#39;iam&#39;)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Additional User data.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="n">origin_type</span> <span class="o">=</span> <span class="s1">&#39;Users&#39;</span>
        <span class="n">origin_id_key</span> <span class="o">=</span> <span class="s1">&#39;UserName&#39;</span>
        <span class="n">origin_index</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">originator</span><span class="p">[</span><span class="n">origin_id_key</span><span class="p">]:</span> <span class="n">originator</span>
            <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">client_method</span><span class="p">,</span> <span class="n">response_data_keys</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_access_keys&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;AccessKeyMetadata&#39;</span><span class="p">:</span> <span class="s1">&#39;AccessKeys&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_groups_for_user&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;Groups&#39;</span><span class="p">:</span> <span class="s1">&#39;Groups&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_user_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;PolicyNames&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyNames&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_attached_user_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">:</span> <span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">]:</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request_for_method_response_for_originator</span><span class="p">(</span>
                    <span class="n">originator</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">client_method</span><span class="p">,</span>
                    <span class="n">response_data_keys</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="k">for</span> <span class="n">request_response_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">get_aws_info_in_parallel</span><span class="p">(</span>
                    <span class="n">requests</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_originator_with_response</span><span class="p">(</span>
                    <span class="n">origin_index</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">request_response_err</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Additional Group data.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="n">origin_type</span> <span class="o">=</span> <span class="s1">&#39;Groups&#39;</span>
        <span class="n">origin_id_key</span> <span class="o">=</span> <span class="s1">&#39;GroupName&#39;</span>
        <span class="n">origin_index</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">originator</span><span class="p">[</span><span class="n">origin_id_key</span><span class="p">]:</span> <span class="n">originator</span>
            <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">client_method</span><span class="p">,</span> <span class="n">response_data_keys</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_group_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;PolicyNames&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyNames&#39;</span><span class="p">}</span>
                    <span class="p">),</span>

                <span class="p">(</span>
                    <span class="s1">&#39;list_attached_group_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">:</span> <span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">]:</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request_for_method_response_for_originator</span><span class="p">(</span>
                    <span class="n">originator</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">client_method</span><span class="p">,</span>
                    <span class="n">response_data_keys</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="k">for</span> <span class="n">request_response_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">get_aws_info_in_parallel</span><span class="p">(</span>
                    <span class="n">requests</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_originator_with_response</span><span class="p">(</span>
                    <span class="n">origin_index</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">request_response_err</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Additional Role data.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="n">origin_type</span> <span class="o">=</span> <span class="s1">&#39;Roles&#39;</span>
        <span class="n">origin_id_key</span> <span class="o">=</span> <span class="s1">&#39;RoleName&#39;</span>
        <span class="n">origin_index</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">originator</span><span class="p">[</span><span class="n">origin_id_key</span><span class="p">]:</span> <span class="n">originator</span>
            <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">client_method</span><span class="p">,</span> <span class="n">response_data_keys</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_role_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;PolicyNames&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyNames&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_attached_role_policies&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">:</span> <span class="s1">&#39;AttachedPolicies&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_instance_profiles_for_role&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;InstanceProfiles&#39;</span><span class="p">:</span> <span class="s1">&#39;InstanceProfiles&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">]:</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request_for_method_response_for_originator</span><span class="p">(</span>
                    <span class="n">originator</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">client_method</span><span class="p">,</span>
                    <span class="n">response_data_keys</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="k">for</span> <span class="n">request_response_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">get_aws_info_in_parallel</span><span class="p">(</span>
                    <span class="n">requests</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_originator_with_response</span><span class="p">(</span>
                    <span class="n">origin_index</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">request_response_err</span>
                    <span class="p">)</span>

        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>
        <span class="c1"># Additional Policy data.</span>
        <span class="c1"># - - - - - - - - - - - - - - - - - - - - - - - -</span>

        <span class="n">origin_type</span> <span class="o">=</span> <span class="s1">&#39;Policies&#39;</span>
        <span class="n">origin_id_key</span> <span class="o">=</span> <span class="s1">&#39;Arn&#39;</span>

        <span class="n">origin_index</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">originator</span><span class="p">[</span><span class="n">origin_id_key</span><span class="p">]:</span> <span class="n">originator</span>
            <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">client_method</span><span class="p">,</span> <span class="n">response_data_keys</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_entities_for_policy&#39;</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s1">&#39;PolicyGroups&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyGroups&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PolicyUsers&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyUsers&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;PolicyRoles&#39;</span><span class="p">:</span> <span class="s1">&#39;PolicyRoles&#39;</span>
                        <span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">(</span>
                    <span class="s1">&#39;list_policy_versions&#39;</span><span class="p">,</span>
                    <span class="p">{</span><span class="s1">&#39;Versions&#39;</span><span class="p">:</span> <span class="s1">&#39;Versions&#39;</span><span class="p">}</span>
                    <span class="p">),</span>
                <span class="p">]:</span>  <span class="c1"># pylint: disable=bad-continuation</span>

            <span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">request_for_method_response_for_originator</span><span class="p">(</span>
                    <span class="n">originator</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">client_method</span><span class="p">,</span>
                    <span class="n">response_data_keys</span><span class="p">,</span>
                    <span class="n">method_id_key</span><span class="o">=</span><span class="s1">&#39;PolicyArn&#39;</span>
                    <span class="p">)</span>
                <span class="k">for</span> <span class="n">originator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">supplementals</span><span class="p">[</span><span class="n">origin_type</span><span class="p">]</span>
                <span class="p">]</span>

            <span class="k">for</span> <span class="n">request_response_err</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">get_aws_info_in_parallel</span><span class="p">(</span>
                    <span class="n">requests</span>
                    <span class="p">):</span>  <span class="c1"># pylint: disable=bad-continuation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_originator_with_response</span><span class="p">(</span>
                    <span class="n">origin_index</span><span class="p">,</span>
                    <span class="n">origin_id_key</span><span class="p">,</span>
                    <span class="n">request_response_err</span>
                    <span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">IAMInformer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Scott Brown.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
